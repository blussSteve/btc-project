<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="/kingGameAdmin/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/kingGameAdmin/css/style.css" />
    <script type="text/javascript" src="/kingGameAdmin/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="/kingGameAdmin/js/bootstrap.js"></script>
    <script type="text/javascript" src="/kingGameAdmin/layer/layer.js"></script>
</head>
<body>
<form class="form-inline definewidth m20">
    关键字 : <input type="text" style="width: 35%;" name="key" id="key" class="abc input-default" placeholder="输入uid，昵称，城市，邀请码" value="" ></input>&nbsp;&nbsp;
    <button type="button" class="btn btn-primary" onclick="search()">查询</button>
</form>
<table class="table table-bordered table-hover definewidth m10" >
    <thead>
    <tr>
        <th>用户uid</th>
        <th>昵称</th>
        <th>房卡数</th>
        <th>积分数</th>
        <th>城市</th>
        <th>邀请码</th>
        <th>创建时间</th>
        <th>操作</th>
    </tr>
    </thead>
    <thead id="datas">
        <tr id="template" hidden="hidden">
           <td id="uid"></td>
           <td id="wxNickname"></td>
           <td id="cards"></td>
           <td id="scores"></td>
           <td id="wxCity"></td>
           <td id="agentUid"></td>
           <td id="createDate"></td>
            <td id="compitor"></td>
        </tr>
    </thead>	
</table>
<div class="inline pull-right page" id="pageMessage">
     每页显示<select id="pageSize"><option>10</option><option>20</option><option>30</option></select>&nbsp;
     共<span id="total"></span>条记录 <span id="page"></span>/<span id="pageTotal"></span>页<a id="frist">首页</a> <a id="upper">上一页</a><a id="next">下一页</a><a id="bottom">最后一页</a>
</div>
</body>
</html>
<script>
	function Trim(str)
	{ 
	    return str.replace(/(^\s*)|(\s*$)/g, ""); 
	}
    function search(){
    	page=parseInt(1);//记录页数
        pageSize=parseInt($("#pageSize").val());//记录页面大小
        total=parseInt(0);//总记录条数
        pageTotal=1;//记录总页数
    	message();
    }
    function lock(uid){
    	var sure=confirm("你确认要锁定该用户吗？");
    	if(sure==true){
    		$.ajax({
    			type: "post",
    			dataType: "json", 
    			url: "/kingGameAdmin/agent/closeOpenAccount",
    			data:{uid:uid,status:'1'}, 
    			success : function(data) {
    				if(data[0].message=='1'){
    					alert("操作成功");
    					message();
    				}
    			}
    		});
    	}
    }
    var page=parseInt(1);//记录页数
    var pageSize=parseInt($("#pageSize").val());//记录页面大小
    var total=parseInt(0);//总记录条数
    var pageTotal=1;//记录总页数
    $(function(){
    	message();
    	$("#frist").click(function() {
    		pageSize=parseInt($("#pageSize").val());
    		page = 1;
    		message();
		});
    	$("#upper").click(function() {
    		pageSize=parseInt($("#pageSize").val());
    		if(page==1){
    			alert("已经是第一页");
    		}else{
    			page=page-1;
        		message();
    		}
		});
    	$("#next").click(function() {
    		pageSize=parseInt($("#pageSize").val());
            if( page>=pageTotal){
            	alert("已经是最后一页");
			}else{
				page=page+1;
				message();
			} 
		});
    	$("#bottom").click(function() {
    		pageSize=parseInt($("#pageSize").val());
    		page=pageTotal;
    		message();
		});
    	$("#pageSize").click(function() {
    		page = 1;
    		pageSize=parseInt($("#pageSize").val());
    		message();
		});
    });
    function message(){
    	var key=Trim($("#key").val());
    	$.ajax({
			type: "post",
			dataType: "json", 
			url: "/kingGameAdmin/user/listUser",
			data:{page:page,pageSize:pageSize,key:key}, 
			success : function(data) {
				$("[id=ready]").remove();
				$.each(data, function(i, n) {
					var row = $("#template").clone();
					row.find("#uid").text(n.uid);    
					row.find("#wxNickname").text(n.wxNickname);
					row.find("#cards").text(n.cards);
					row.find("#scores").text(n.scores);
					row.find("#wxCity").text(n.wxCity);
					row.find("#agentUid").text(n.agentUid);
					row.find("#createDate").text(n.createDate.substring(0,19));
					if(n.enabled==1){
                        row.find("#compitor").append('<a onclick="updateStatus('+n.uid+')">封号</a>');
                    }
                    if(n.enabled==0){
                        row.find("#compitor").append('<a onclick="updateStatus('+n.uid+')">解封</a>');
                    }
					row.attr("id", "ready");
					row.appendTo("#datas"); 
				});
				$("[id=ready]").show();
			}
		});
    	pageMessage(key);
    }
    function pageMessage(key){
    	$.ajax({
			type: "post",
			dataType: "json", 
			url: "/kingGameAdmin/user/pageCount",
			data:{key:key}, 
			success : function(data) {
				total=data[0].message;
				if(pageSize>=total){
					pageTotal=1;
				}else{
					if(total%pageSize>0){	
						pageTotal=parseInt(total/pageSize)+1;
					}
					if(total%pageSize==0){
						pageTotal=parseInt(total/pageSize);
					}
				}
				$("#total").html(total);
				$("#pageTotal").html(pageTotal);
				$("#page").html(page);
			}
		});
    }
    function updateStatus(uid){
        $.ajax({
            type: "post",
            dataType: "json",
            url: "/kingGameAdmin/user/updateStatus",
            data:{uid:uid},
            success : function(data) {
                if(data[0].message==1){
                    alert("操作成功");
                    message();
                }
            }
        });
    }
</script>