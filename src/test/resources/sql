-- 2018年9月14日
ALTER TABLE `ssm_db`.`ssm_bk_match`
CHANGE COLUMN `a_is_finished` `a_is_finished` CHAR(1) NOT NULL DEFAULT '0' COMMENT '0: 未完成； 1： 已经完成； 2： 过期或者无效' ;

-- 2018年9月19日
CREATE TABLE `ssm_db`.`ssm_guid_info` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `guid_group` VARCHAR(45) NOT NULL,
  `guid_type` VARCHAR(45) NOT NULL,
  `guid_type_name` VARCHAR(128) NOT NULL COMMENT '文档说明信息',
  `guid_content` LONGTEXT NOT NULL,
  `gmt_create` DATETIME NOT NULL DEFAULT now(),
  `gtm_modified` DATETIME NOT NULL DEFAULT now(),
  PRIMARY KEY (`id`));

-- 2018.9.20
CREATE TABLE `ssm_db`.`ssm_access_log` (
  `xuid` VARCHAR(128) NULL,
  `user_info_id` BIGINT(20) NULL,
  `ip` VARCHAR(45) NULL,
  `path_id` BIGINT(20) NOT NULL COMMENT '路径编号',
  `gmt_create` DATETIME NOT NULL DEFAULT now())
COMMENT = '埋点信息';

ALTER TABLE `ssm_db`.`ssm_access_log`
DROP COLUMN `xuid`;


ALTER TABLE `ssm_db`.`ssm_access_path`
ADD UNIQUE INDEX `path_UNIQUE` (`path` ASC);
;



CREATE TABLE `ssm_access_path` (  `id` bigint(20) NOT NULL AUTO_INCREMENT, `path` varchar(128) NOT NULL,  `memo` varchar(128) NOT NULL,  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,  PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='路径说明';

#提现金额
ALTER TABLE ssm_db ADD `draw_money` DECIMAL(10,2) DEFAULT '0.00' COMMENT '提现金额';


-- 2018.9.29
-- 更新缺失的学校图标为默认图标， 临时表里面存的是远程文件系统里面的学校图片路径
update ssm_school  set img = 'activity/school-images/schoolIcon/init/gx/default_h.png' where  not exists (select 1 from school_icon_temp p where p.icon_path = img);

#是否将微信和xuid绑定(20180929)
ALTER TABLE ssm_user_info ADD `is_bind_wx` INT(1) DEFAULT '0' COMMENT '是否绑定微信';

#增加系统公告表(20180930)

CREATE TABLE `ssm_announcement` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `t_type` int(1) NOT NULL COMMENT '文本类型',
  `t_content` varchar(512) DEFAULT NULL COMMENT '公告内容',
  `status` int(1) DEFAULT '1' COMMENT '公告状态[1.启用 0.禁用]',
  `gmt_update` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',
  `gmt_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

#增加账户id
ALTER TABLE ssm_user_info ADD `account_id` bigint(20) DEFAULT NULL COMMENT '账户id';

#恒生卖出交易流水缓存
CREATE TABLE `hs_sell_tran_temp` (
  `user_id` bigint(20) NOT NULL COMMENT '用户id',
  `position_str` varchar(128) DEFAULT NULL COMMENT '恒生接口流水定位号',
  PRIMARY KEY (`user_id`),
  KEY `position_str` (`position_str`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

#去除hs_sell_tran_temp主键(20181023)
ALTER TABLE hs_sell_tran_temp DROP PRIMARY KEY;

#ssm_school_rank_cache_one增加teamid(20181023)
ALTER TABLE ssm_school_rank_cache_one  ADD `team_id` BIGINT(20) DEFAULT NULL COMMENT '战队id';

#ssm_batch_log(20181023)
ALTER TABLE ssm_batch_log MODIFY COLUMN log_desc TEXT;

#ssm_team_user(20181023)
ALTER TABLE ssm_team_user ADD UNIQUE KEY `team_id_2_user_id` (`team_id`,`join_user_id`);

#ssm_hot_msg(20181023)
ALTER TABLE ssm_hot_msg MODIFY COLUMN stock_code VARCHAR(10);

#ssm_team_rank(20181025)
ALTER TABLE ssm_team_rank ADD `big_total_income` DECIMAL(18,6) DEFAULT NULL COMMENT '最高收益';

#(20181106)
ALTER TABLE ssm_account ADD `can_use_assets` DECIMAL(10,2) DEFAULT '0.00' COMMENT '可用资金(等于账户总资产-股票持仓成本价-现委托冻结金额)';

DROP TABLE ssm_account_captial_reocrd;
CREATE TABLE `ssm_account_captial_reocrd` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `user_id` bigint(20) DEFAULT NULL,
  `money` decimal(16,4) DEFAULT NULL COMMENT '资金',
  `org_user_money` decimal(16,4) DEFAULT NULL COMMENT '用之前资金',
  `dest_user_money` decimal(16,4) DEFAULT NULL COMMENT '现在资金',
  `op_type` int(11) DEFAULT NULL COMMENT '操作',
  `mark` varchar(1024) DEFAULT NULL COMMENT '备注',
  `gmt_date` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8;


DROP TABLE assets_temp;

CREATE TABLE `assets_temp` (
  `can_use_assets` decimal(16,2) DEFAULT NULL,
  `account_no` varchar(20) NOT NULL,
  `assets` decimal(16,2) DEFAULT NULL,
  `market` decimal(16,2) DEFAULT NULL,
  `gmt_date` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`account_no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `ssm_user_popular_rank` (
  `user_id` bigint(20) NOT NULL,
  `invite_money` decimal(15,2) DEFAULT NULL COMMENT '邀请金额',
  `invite_person_count` int(11) DEFAULT NULL COMMENT '邀请人数',
  `rank` int(11) DEFAULT NULL COMMENT '排行',
  `rank_change` int(11) DEFAULT NULL COMMENT '排行浮动',
  `gmt_date` datetime DEFAULT NULL COMMENT '创建时间',
  `modify_date` datetime DEFAULT NULL COMMENT '修改时间',
  PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE ssm_entrust_record;

CREATE TABLE `ssm_entrust_record` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `user_id` bigint(20) DEFAULT NULL,
  `money` decimal(12,0) DEFAULT NULL,
  `entrust_type` int(11) DEFAULT NULL,
  `entrust_no` varchar(60) DEFAULT NULL,
  `entrust_count` int(11) DEFAULT NULL,
  `status` int(11) DEFAULT NULL,
  `entrust_price` decimal(12,0) DEFAULT NULL,
  `stock_code` varchar(36) DEFAULT NULL,
  `mark` varchar(768) DEFAULT NULL,
  `gmt_date` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8;

CREATE TABLE `hs_tran_record` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `init_date` varchar(12) DEFAULT NULL COMMENT '日期',
  `push_type` varchar(2) DEFAULT NULL COMMENT '推送类型[1.买 2.卖]',
  `push_data` text COMMENT '推送时间',
  `create_date` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#20181114
ALTER TABLE `ssm_comment` ADD `is_push` INT(1) DEFAULT '0' COMMENT '是否置顶 1是 0否';
